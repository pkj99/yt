<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>xplayer</title>

    <link rel="icon" type="image/png" href="images/favicon.ico">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/favicon.ico" />    

	<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,viewport-fit=cover">
	<meta name="renderer" content="webkit"> <!-- (webkit) -->
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<meta http-equiv="Cache-Control" content="no-transform">
	<meta name="applicable-device" content="mobile">
	<meta name="screen-orientation" content="portrait">
	<meta name="x5-orientation" content="portrait">
	<meta name="description" content="xplayer">
	<meta name="keywords" content="xplayer">
	<meta name="referrer" content="same-origin">
	<script src="js/hls.min.js"></script>
	<script src="js/artplayer.js"></script>
    <link rel="stylesheet" href="css/artplayer.css" type="text/css" />
</head>

<body>

	<div id="artplayer-app" data-art-id="1">
		<div class="art-video-player art-subtitle-show art-layer-show art-backdrop art-control-show art-mask-show"
			style="--art-theme: #e91e63;"><video class="art-video" preload="metadata" autoplay="" playsinline=""
				src="">
				<track default="" kind="metadata" src="">
			</video>
			<div class="art-poster" style="display: none;"></div>
		</div>
	</div>

	<script type="text/javascript">

		var urlParams;
		(window.onpopstate = function () {
			var match,
				pl = /\+/g,  // Regex for replacing addition symbol with a space
				search = /([^&=]+)=?([^&]*)/g,
				decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
				query = window.location.search.substring(1);

			urlParams = {};
			while (match = search.exec(query))
				urlParams[decode(match[1])] = decode(match[2]);
		})();
		if (urlParams["url"] == null) { var url = ""; } else { var url = urlParams["url"]; }
		if (urlParams["img"] == null) { var img = ""; } else { var img = urlParams["img"]; }


		Artplayer.CONTEXTMENU = false;
		var art = new Artplayer({
			container: '#artplayer-app',
			url: url,
			poster: img,
			theme: '#e91e63',
			autoplay: true,
			playbackRate: true,
			autoPlayback: true,
			volume: 0.9,
			hotkey: true,
			pip: true,
			fullscreen: true,
			fullscreenWeb: true,
			setting: true,
			miniProgressBar: false,
			whitelist: ['*'],
			lock: true,
			fastForward: true,
			autoOrientation: true,
			airplay: true,
			type: 'hls',
			customType: {
				hls: function (video, url) {
					if (Hls.isSupported()) {
						const hls = new Hls();
						hls.config.maxBufferLength = 160;
						hls.loadSource(url);
						hls.attachMedia(video);
					} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
						video.src = url;
					} else {
						art.notice.show = '不支持播放格式：m3u8';
					}
				},
			},
		});

		fetch(url, {
			method: 'HEAD',
			redirect: 'manual',
			// mode: 'no-cors'
		}).then(res => {
			const type = res.headers.get('content-type');
			if (res.status === 301 || res.status === 302 || res.status === 0 || type.includes('video/mp4')) {
				//if (type.includes('video/mp4')) {
				art.type = 'mp4';
				art.url = res.url;
			} else {
				art.url = res.url;
			}

		}).catch(error => {
			console.error('Error fetching the URL:', error);
		});


		art.on('fullscreenWeb', (...args) => {
			window.parent.postMessage({ message: 'fullscreenWeb', isfull: args }, '*');
		});

	</script>

</body>
</html>