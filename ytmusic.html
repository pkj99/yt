<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberMusic</title>
    <link rel="icon" type="image/png" href="images/favicon.ico">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/favicon.ico" />      
    <style>
        :root {
            --neon-cyan: #00f2ff;
            --neon-purple: #bc13fe;
            --bg-dark: #050505;
        }

        body {
            background: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* --- 1. å›ºå®šé ‚éƒ¨é¸å–® --- */
        .header-fixed {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(20px);
            padding: 15px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-scroll {
            display: flex; gap: 12px; padding: 0 20px; 
            overflow-x: auto; scrollbar-width: none; /* éš±è—æ²è»¸ */
        }
        .nav-scroll::-webkit-scrollbar { display: none; }
        .nav-item {
            white-space: nowrap; padding: 8px 18px; border: 1px solid var(--neon-cyan);
            border-radius: 20px; color: var(--neon-cyan); cursor: pointer; transition: 0.3s;
        }
        .nav-item.active { background: var(--neon-cyan); color: #000; box-shadow: 0 0 10px var(--neon-cyan); }

        /* --- 2. æ­Œæ›²æ¸…å–® (éš±è—å·è»¸) --- */
        .main-content {
            flex: 1; overflow-y: auto; padding: 2px; 
            max-width: 800px; margin: 0 auto; width: 96%;
            scrollbar-width: none; /* Firefox éš±è—æ²è»¸ */
        }
        .main-content::-webkit-scrollbar { display: none; /* Chrome éš±è—æ²è»¸ */ }

        .track-item {
            display: flex; align-items: center; padding: 12px; background: rgba(255,255,255,0.03);
            border-radius: 12px; margin-bottom: 10px; cursor: pointer; border: 1px solid transparent;
        }
        .track-item.playing { border-color: var(--neon-purple); background: rgba(188, 19, 254, 0.05); }
        .track-item img { width: 50px; height: 50px; border-radius: 8px; margin-right: 15px; }
        /* åç¨±èˆ‡æ­Œæ‰‹æ›è¡Œ */
        .track-info-list { display: flex; flex-direction: column; }
        .track-info-list b { font-size: 1rem; margin-bottom: 4px; }
        .track-info-list span { color: #888; font-size: 0.85rem; }


        .current-track-img {
            width: 100%;
            height: 100%;
            border-radius: 50% !important;
            border: 2px solid var(--neon-purple);
            object-fit: cover;
            animation: rotate 12s linear infinite;
            animation-play-state: paused;
        }
        .current-track-img.playing { animation-play-state: running; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- 3. æ’­æ”¾å™¨å®¹å™¨ --- */
        .player-bar {
            position: fixed; bottom: 0; width: 100%;
            background: #000; border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 2000; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            height: 90px;
        }

        .player-inner {
            display: flex; align-items: center; justify-content: space-between;
            height: 100%; padding: 0 25px; max-width: 1400px; margin: 0 auto; box-sizing: border-box;
        }

        .back-btn { display: none; cursor: pointer; font-size: 2rem; padding: 10px; color: white; }

        .info-box { display: flex; align-items: center; flex: 1; min-width: 0; }
        #barArt { width: 55px; height: 55px; border-radius: 6px; object-fit: cover; margin-right: 15px; }
        .text-wrap { display: flex; flex-direction: column; overflow: hidden; }
        .text-wrap b { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .prog-container { flex: 2; margin: 0 40px; display: flex; align-items: center; gap: 12px; }
        #progressBar { flex: 1; accent-color: white; cursor: pointer; }
        .time-txt { font-size: 0.75rem; color: #888; min-width: 35px; }

        /* --- 4. æŒ‰éµæ¨£å¼å„ªåŒ– --- */
        .control-set { display: flex; align-items: center; gap: 20px; flex: 1; justify-content: flex-end; }
        
        /* é»‘ç™½éš¨æ©Ÿ/å¾ªç’° */
        .btn-bw {
            font-size: 1.8rem; cursor: pointer; opacity: 0.8; transition: 0.3s;
            filter: grayscale(1);
        }
        .btn-bw.active { opacity: 1; filter: grayscale(0); }

        /* æ’­æ”¾éˆ•ç½®ä¸­ä¿®å¾© */
        .btn-play {
            width: 55px; height: 55px; background: white; color: black; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; cursor: pointer;
            box-shadow: 0 0 15px rgba(255,255,255,0.4);
        }
        /* å¾®èª¿ä¸‰è§’æ’­æ”¾åœ–æ¨™ä½ç½® */
        .play-icon-adj { margin-left: 4px; } 

        .btn-nav { font-size: 2.0rem; cursor: pointer; color: white; }

        /* --- 5. æ‰‹æ©Ÿå…¨è¢å¹• (Mobile Only) --- */
        @media (max-width: 768px) {

            /* .prog-container { width: 0%; display:none; } */
            .prog-container { display:none; }
            .control-set { width: 100%; justify-content: space-between; }
            /* .info-box { width: 0%; display: none;} */
            .text-wrap { width: 0%;}
            /* #barArt { width: 0px; height: 0px; border-radius: 6px; object-fit: cover; margin-right: 15px; } */

            /* .current-track-img {
                width: 100%;
                height: 100%;
                border-radius: 50% !important;
                border: 2px solid gray;
                object-fit: cover;
                animation:none;
                animation-play-state: paused;
            }
            .current-track-img.playing { animation-play-state: running; }

            @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } */


            .player-bar.expanded .current-track-img {
                width: 100%;
                height: 100%;
                border-radius: 6% !important;
                border: 2px solid gray;
                object-fit: cover;
                animation:none;
                animation-play-state: paused;
            }
            .player-bar.expanded .current-track-img.playing { animation-play-state: running; }


            .player-bar.expanded { height: 100vh; border-top: none; }
            .player-bar.expanded .back-btn { display: block; position: absolute; top: 50px; left: 15px; z-index: 2100; }
            
            .player-bar.expanded .player-inner {
                flex-direction: column; justify-content: space-evenly; padding: 60px 30px 40px;
            }

            .player-bar.expanded .info-box { 
                display: flex;               
                flex-direction: column; align-items: flex-start; flex: 0; width: 100%;
            }
            .player-bar.expanded #barArt {
                width: 100% !important; max-width: 300px; height: auto; aspect-ratio: 1/1; 
                margin: 0 auto 30px; border-radius: 15px;
            }

            /* æ‰‹æ©Ÿç‰ˆé€²åº¦æ¢ç¸®å°å¯¬åº¦ */
            .player-bar.expanded .prog-container {
                display: flex; 
                width: 90%; flex: 0; margin: 0 auto 20px; order: 2;
            }
            .player-bar.expanded .control-set {
                width: 100%; justify-content: space-between; flex: 0; order: 3; padding: 0 10px;
            }
            .player-bar.expanded .btn-play { width: 75px; height: 75px; font-size: 2rem; }

            .player-bar.expanded .btn-bw {
                font-size: 2.2rem; cursor: pointer; opacity: 0.8; transition: 0.3s;
            }
            .player-bar.expanded .btn-nav { font-size: 2.2rem; cursor: pointer; color: white; }

            .player-bar.expanded .text-wrap { width:100%; display:flex;}
            .player-bar.expanded .text-wrap b { font-size: 1.6rem; white-space: normal; overflow: hidden; text-overflow: ellipsis;}


        }
    </style>
</head>
<body>

<div class="header-fixed">
    <div class="nav-scroll" id="playlistNav">
        <div class="nav-item" onclick="window.location='index.html'"><img src="./images/home2.png" width="20px"></div>
    </div>
</div>

<div class="main-content" id="songList"></div>

<div class="player-bar" id="playerOverlay">
    <span class="back-btn" onclick="toggleExpand()">ï¸¾</span>
    
    <div class="player-inner">
        <div class="info-box" onclick="toggleExpand()">
            <img id="barArt" class="current-track-img" src="https://img.icons8.com/ios-filled/150/ffffff/music-record.png">
            <div class="text-wrap">
                <b id="barTitle">å°šæœªæ’­æ”¾</b>
                <span id="barArtist">ç­‰å¾…é¸å–æ¸…å–®</span>
            </div>
        </div>

        <div class="prog-container">
            <span class="time-txt" id="curT">0:00</span>
            <input type="range" id="progressBar" value="0" min="0" max="100" oninput="seekTo(this.value)">
            <span class="time-txt" id="durT">0:00</span>
        </div>

        <div class="control-set">
            <span class="btn-bw" id="shuffleBtn" onclick="toggleShuffle()">ğŸ”€</span>
            <span class="btn-nav" onclick="prevTrack()">â®</span>
            <div class="btn-play" onclick="togglePlay()">
                <span id="playIcon" class="play-icon-adj">â–¶</span>
            </div>
            <span class="btn-nav" onclick="nextTrack()">â­</span>
            <span class="btn-bw" id="repeatBtn" onclick="toggleRepeat()">ğŸ”</span>
        </div>
    </div>
</div>

<div style="display:none"><div id="player"></div></div>

<script>
    let playlists = [];
    let currentPlaylistIndex = 0;
    let currentSongIndex = 0;
    let isShuffle = false;
    let isRepeat = false;
    let player;
    let isPlaylistChanged = false;

    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    async function onYouTubeIframeAPIReady() {
        try {
            const res = await fetch('js/musics_data.json');
            playlists = await res.json();
            player = new YT.Player('player', {
                events: {
                    'onReady': () => { initNav(); loadPlaylist(0); },
                    'onStateChange': onPlayerStateChange
                }
            });
        } catch(e) { console.error("JSON Error"); }
    }

    function initNav() {
        const nav = document.getElementById('playlistNav');
        playlists.forEach((p, idx) => {
            const name = Object.keys(p)[0];
            const div = document.createElement('div');
            div.className = `nav-item ${idx === 0 ? 'active' : ''}`;
            div.innerText = name;
            div.onclick = () => {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                div.classList.add('active');
                loadPlaylist(idx);
            };
            nav.appendChild(div);
        });
    }

    function loadPlaylist(idx) {
        if (currentPlaylistIndex !== idx){
            currentSongIndex = 0;
            isPlaylistChanged = true;
        } else { isPlaylistChanged = false;}

        currentPlaylistIndex = idx;
        const name = Object.keys(playlists[idx])[0];
        const songs = playlists[idx][name];
        const container = document.getElementById('songList');
        container.innerHTML = '';
        songs.forEach((s, sIdx) => {
            const item = document.createElement('div');
            item.className = `track-item ${currentSongIndex === sIdx && currentPlaylistIndex === idx ? 'playing' : ''}`;
            item.onclick = () => playTrack(sIdx);
            item.innerHTML = `<img src="https://i.ytimg.com/vi/${s.id}/mqdefault.jpg">
                <div class="track-info-list"><b>${s.title}</b><span>${s.artist}</span></div>`;
            container.appendChild(item);
        });

        if (isPlaylistChanged){
            container.scrollTo({
                top: 0,
                behavior: 'smooth' // å¹³æ»‘æ»¾å‹•æ•ˆæœ
            });
        }
    }

    function playTrack(sIdx) {
        currentSongIndex = sIdx;
        const song = playlists[currentPlaylistIndex][Object.keys(playlists[currentPlaylistIndex])[0]][sIdx];
        player.loadVideoById(song.id);
        
        document.getElementById('barTitle').innerText = song.title;
        document.getElementById('barArtist').innerText = song.artist;
        document.getElementById('barArt').src = `https://i.ytimg.com/vi/${song.id}/maxresdefault.jpg`;
        document.getElementById('barArt').classList.add('playing');

        if (window.innerWidth <= 768) {
            document.getElementById('playerOverlay').classList.add('expanded');
        }
        loadPlaylist(currentPlaylistIndex);
    }

    function toggleExpand() {
        if (window.innerWidth <= 768) {
            document.getElementById('playerOverlay').classList.toggle('expanded');
        }
    }

    function togglePlay() {
        if (currentSongIndex === -1) return;
        player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo();
    }

    function onPlayerStateChange(event) {
        const icon = document.getElementById('playIcon');
        const img = document.getElementById('barArt');
        if (event.data === 1) {
            icon.innerText = 'â¸';
            img.classList.add('playing');
            icon.classList.remove('play-icon-adj'); // æš«åœéˆ•ä¸éœ€è¦å³ç§»ä½
            setInterval(updateTick, 1000);
        } else {
            icon.innerText = 'â–¶';
            img.classList.remove('playing');
            icon.classList.add('play-icon-adj'); // æ’­æ”¾éˆ•ä¸‰è§’å‹å¾®èª¿ç½®ä¸­
        }
        if (event.data === 0) { isRepeat ? playTrack(currentSongIndex) : nextTrack(); }
    }

    function updateTick() {
        const curr = player.getCurrentTime();
        const dur = player.getDuration();
        if (dur > 0) {
            document.getElementById('progressBar').value = (curr / dur) * 100;
            document.getElementById('curT').innerText = fmt(curr);
            document.getElementById('durT').innerText = fmt(dur);
        }
    }

    function seekTo(v) { player.seekTo((v / 100) * player.getDuration(), true); }
    function fmt(s) { return `${Math.floor(s / 60)}:${Math.floor(s % 60).toString().padStart(2, '0')}`; }

    function nextTrack() {
        const songs = playlists[currentPlaylistIndex][Object.keys(playlists[currentPlaylistIndex])[0]];
        let next = isShuffle ? Math.floor(Math.random() * songs.length) : (currentSongIndex + 1) % songs.length;
        playTrack(next);
    }

    function prevTrack() {
        const songs = playlists[currentPlaylistIndex][Object.keys(playlists[currentPlaylistIndex])[0]];
        let prev = (currentSongIndex - 1 + songs.length) % songs.length;
        playTrack(prev);
    }

    function toggleShuffle() {
        isShuffle = !isShuffle;
        document.getElementById('shuffleBtn').classList.toggle('active', isShuffle);
    }

    function toggleRepeat() {
        isRepeat = !isRepeat;
        document.getElementById('repeatBtn').classList.toggle('active', isRepeat);
    }
</script>
</body>
</html>